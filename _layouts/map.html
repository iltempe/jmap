---
layout: page_map
---
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" integrity="sha512-WXoSHqw/t26DszhdMhOXOkI7qCiv5QWXhH9R7CgvgZMHz1ImlkVQ3uNsiQKu5wwbbxtPzFXd1hK4tzno2VqhpA==" crossorigin=""></script>

<link rel="stylesheet" href="{{"/assets/css/leaflet.awesome-markers.css" | prepend: site.baseurl }}">
<script type="text/javascript" src="{{"/assets/js/leaflet.awesome-markers.js" | prepend: site.baseurl  }}"></script>

<link rel="stylesheet" href="{{"/assets/css/gh-fork-ribbon.css"| prepend: site.baseurl }}">
<script type="text/javascript" src="{{"/assets/js/leaflet-providers.js" | prepend: site.baseurl  }}"></script>

<link rel="stylesheet" href="{{"/assets/css/MarkerCluster.css" | prepend: site.baseurl }}">
<link rel="stylesheet" href="{{"/assets/css/MarkerCluster.Default.css" | prepend: site.baseurl }}">
<script type="text/javascript" src="{{"/assets/js/leaflet.markercluster-src.js" | prepend: site.baseurl  }}"></script>

<link rel="stylesheet" href='https://unpkg.com/mapillary-js@2.7.0/dist/mapillary.min.css'>
<script type="text/javascript" src='https://unpkg.com/mapillary-js@2.7.0/dist/mapillary.min.js'></script>


<style>
#map{
  height: 800px;
  width: 100%;
}
</style>

<article>
  <div id="map"></div>

  <script>

    //setting icons
    var Marker = L.AwesomeMarkers.icon({
    icon: '{{page.marker.icon}}',
    prefix: 'fa',
    markerColor: '{{page.marker.color}}'});

    var markerList=[];
    var popupList=[];

    //find the dataset
    {% assign data_file = page.dataset %}

    //find the coordinates in the dataset
    {% for member in site.data[data_file] %}
      markerList.push([{{member.lat}}, {{member.lon}}]);
      popupList.push(["{{member[page.popup]}}"]);
    {% endfor %}

    // init map
    var map = L.map('map', {
        minZoom: 1,
        maxZoom: 20
    });
    var markers = L.markerClusterGroup();
    var sumLat = 0.;
    var sumLon = 0.;
    var countMarkers=0;

    // create the style tile layer
    var style = L.tileLayer.provider('{{page.style}}').addTo(map);

    //create the markers
    for (var i=0; i<markerList.length; i++) {
            var lat = markerList[i][0];
            var lon = markerList[i][1];
            var popup = popupList[i];

            if (!isNaN(lat) && !isNaN(lon)) {
              var markerLocation = new L.LatLng(lat, lon);
              var marker = new L.Marker(markerLocation, {icon: Marker});
              if({{page.cluster}})
              {
                markers.addLayer(marker);
              }else{
                map.addLayer(marker);
              }
              if(popup != "")
              {
                marker.bindPopup(''+popup);
              }
              sumLat += lat;
              sumLon += lon;
              countMarkers++;
            }
    }

    //create clusters
    if({{page.cluster}})
    {
      map.addLayer(markers);
    }

    //set the map view
    var center_map=[];
    var zoom_map = 6;
    {% if page.view %}
    {
      center_map=[{{page.view.center_lat}},{{page.view.center_lon}}];
      zoom_map={{page.view.zoom}};
      map.addLayer(style).setView(center_map,zoom_map);
    }
    {% else %}{
      center_map=[sumLat / countMarkers, sumLon / countMarkers];
      map.addLayer(style).setView(center_map, zoom_map);
    }{% endif %}

    //any post to be mapped here?
    JekyllMapPosts();

    //set streetview
    {% if page.streetview == true %}
      {



      }{% endif %}

//manages post mapping
function JekyllMapPosts() {
    this.map;
    this.data = {
      type: 'FeatureCollection',
      features: [
        {% for post in site.posts %}
          {% if post.map == page.title %}
              {
                'type': 'Feature',
                'properties': '{{ post.title }}',
                'link':'{{post.url | prepend: site.baseurl}}',
                'geometry': {
                  'type': 'Point',
                  'coordinates': [
                    {{ post.lon }},
                    {{ post.lat }}
                  ]
                }
              },
            {% endif %}
          {% endfor %}
      ]
    };
  var myPostLayer = L.geoJSON(data, {onEachFeature: function (features, layer) {
    layer.bindPopup('<a href='+features.link+' itemprop="url">'+features.properties+'</a>');
  }}).addTo(map);
  myPostLayer.addData(this.data);
}
</script>
</article>